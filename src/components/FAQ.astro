---
/**
 * Composant FAQ Visuel avec accordéon
 * Support Schema.org pour Featured Snippets
 */

interface FAQItem {
  question: string;
  answer: string;
}

interface Props {
  title?: string;
  items: FAQItem[];
  schemaType?: 'FAQPage' | 'none'; // Si déjà un FAQPage schema ailleurs
}

const {
  title = "Questions Fréquentes",
  items,
  schemaType = 'none'
} = Astro.props;

// Générer un ID unique pour chaque item
const generateId = (index: number) => `faq-${index}-${Math.random().toString(36).substr(2, 9)}`;
---

{schemaType === 'FAQPage' && (
  <script type="application/ld+json" set:html={JSON.stringify({
    "@context": "https://schema.org",
    "@type": "FAQPage",
    "mainEntity": items.map(item => ({
      "@type": "Question",
      "name": item.question,
      "acceptedAnswer": {
        "@type": "Answer",
        "text": item.answer
      }
    }))
  })} />
)}

<section class="faq-section py-12 bg-gradient-to-br from-blue-50 to-indigo-50 rounded-xl">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
    <h2 class="text-3xl font-bold text-center text-gray-900 mb-2">{title}</h2>
    <p class="text-center text-gray-600 mb-8">
      Trouvez rapidement les réponses à vos questions
    </p>

    <div class="space-y-4">
      {items.map((item, index) => {
        const itemId = generateId(index);
        return (
          <details class="faq-item bg-white rounded-lg shadow-sm overflow-hidden group">
            <summary class="faq-question flex items-center justify-between p-6 cursor-pointer hover:bg-gray-50 transition-colors">
              <h3 class="text-lg font-semibold text-gray-900 pr-8">
                {item.question}
              </h3>
              <svg
                class="w-6 h-6 text-blue-600 flex-shrink-0 transform transition-transform group-open:rotate-180"
                viewBox="0 0 24 24"
                fill="none"
                aria-hidden="true"
              >
                <path d="M19 9l-7 7-7-7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
              </svg>
            </summary>
            <div class="faq-answer p-6 pt-0 text-gray-700 leading-relaxed">
              <p set:html={item.answer} />
            </div>
          </details>
        );
      })}
    </div>

    <!-- CTA après FAQ -->
    <div class="mt-10 text-center">
      <p class="text-gray-600 mb-4">Vous ne trouvez pas la réponse à votre question ?</p>
      <a
        href="/contact/"
        class="inline-flex items-center px-6 py-3 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors"
      >
        <svg class="w-5 h-5 mr-2" viewBox="0 0 24 24" fill="none" aria-hidden="true">
          <path d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Contactez nos Experts
      </a>
    </div>
  </div>
</section>

<style>
  .faq-item {
    border: 1px solid #e5e7eb;
  }

  .faq-item:hover {
    border-color: #3b82f6;
  }

  .faq-question {
    list-style: none;
    position: relative;
  }

  .faq-question::-webkit-details-marker,
  .faq-question::marker {
    display: none;
  }

  details[open] .faq-answer {
    animation: slideDown 0.3s ease-out;
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Focus states pour accessibilité */
  .faq-question:focus {
    outline: 2px solid #3b82f6;
    outline-offset: 2px;
  }

  /* Responsive */
  @media (max-width: 640px) {
    .faq-question h3 {
      font-size: 1rem;
    }
  }
</style>

<script>
  // Analytics tracking pour FAQ interactions (optionnel)
  document.addEventListener('DOMContentLoaded', () => {
    const faqItems = document.querySelectorAll('.faq-item');

    faqItems.forEach((item, index) => {
      item.addEventListener('toggle', (e) => {
        if ((e.target as HTMLDetailsElement).open) {
          // Track FAQ open event
          console.log(`FAQ opened: Item ${index}`);
          // window.gtag?.('event', 'faq_open', { faq_index: index });
        }
      });
    });
  });
</script>
